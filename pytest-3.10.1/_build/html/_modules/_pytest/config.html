
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>_pytest.config &#8212; pytest documentation</title>
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/pytest1favi.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
  </head><body>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../contents.html">pytest-3.10</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">

  <h1>Source code for _pytest.config</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; command line options, ini-file and conftest.py processing. &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">distutils.version</span> <span class="kn">import</span> <span class="n">LooseVersion</span>

<span class="kn">import</span> <span class="nn">py</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">pluggy</span> <span class="kn">import</span> <span class="n">HookimplMarker</span>
<span class="kn">from</span> <span class="nn">pluggy</span> <span class="kn">import</span> <span class="n">HookspecMarker</span>
<span class="kn">from</span> <span class="nn">pluggy</span> <span class="kn">import</span> <span class="n">PluginManager</span>

<span class="kn">import</span> <span class="nn">_pytest._code</span>
<span class="kn">import</span> <span class="nn">_pytest.assertion</span>
<span class="kn">import</span> <span class="nn">_pytest.hookspec</span>  <span class="c1"># the extension point definitions</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">PrintHelp</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">UsageError</span>
<span class="kn">from</span> <span class="nn">.findpaths</span> <span class="kn">import</span> <span class="n">determine_setup</span>
<span class="kn">from</span> <span class="nn">.findpaths</span> <span class="kn">import</span> <span class="n">exists</span>
<span class="kn">from</span> <span class="nn">_pytest._code</span> <span class="kn">import</span> <span class="n">ExceptionInfo</span>
<span class="kn">from</span> <span class="nn">_pytest._code</span> <span class="kn">import</span> <span class="n">filter_traceback</span>
<span class="kn">from</span> <span class="nn">_pytest.compat</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">_pytest.compat</span> <span class="kn">import</span> <span class="n">safe_str</span>
<span class="kn">from</span> <span class="nn">_pytest.outcomes</span> <span class="kn">import</span> <span class="n">Skipped</span>

<span class="n">hookimpl</span> <span class="o">=</span> <span class="n">HookimplMarker</span><span class="p">(</span><span class="s2">&quot;pytest&quot;</span><span class="p">)</span>
<span class="n">hookspec</span> <span class="o">=</span> <span class="n">HookspecMarker</span><span class="p">(</span><span class="s2">&quot;pytest&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ConftestImportFailure</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">excinfo</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">excinfo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excinfo</span> <span class="o">=</span> <span class="n">excinfo</span>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../reference.html#_pytest.config.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; return exit code, after performing an in-process test run.</span>

<span class="sd">    :arg args: list of command line arguments.</span>

<span class="sd">    :arg plugins: list of plugin objects to be auto-registered during</span>
<span class="sd">                  initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">_pytest.main</span> <span class="kn">import</span> <span class="n">EXIT_USAGEERROR</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">_prepareconfig</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">plugins</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ConftestImportFailure</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">ExceptionInfo</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">excinfo</span><span class="p">)</span>
            <span class="n">tw</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">TerminalWriter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                <span class="s2">&quot;ImportError while loading conftest &#39;</span><span class="si">{e.path}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">e</span><span class="p">),</span> <span class="n">red</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">exc_info</span><span class="o">.</span><span class="n">traceback</span> <span class="o">=</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">traceback</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filter_traceback</span><span class="p">)</span>
            <span class="n">exc_repr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">exc_info</span><span class="o">.</span><span class="n">getrepr</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;short&quot;</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">traceback</span>
                <span class="k">else</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">exconly</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">formatted_tb</span> <span class="o">=</span> <span class="n">safe_str</span><span class="p">(</span><span class="n">exc_repr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">formatted_tb</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">tw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span> <span class="n">red</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_cmdline_main</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">config</span><span class="o">.</span><span class="n">_ensure_unconfigure</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">UsageError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">tw</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">TerminalWriter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s2">&quot;ERROR: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">red</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">EXIT_USAGEERROR</span></div>


<span class="k">class</span> <span class="nc">cmdline</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>  <span class="c1"># compatibility namespace</span>
    <span class="n">main</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">filename_arg</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">optname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Argparse type validator for filename arguments.</span>

<span class="sd">    :path: path of filename</span>
<span class="sd">    :optname: name of the option</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> must be a filename, given: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optname</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="k">def</span> <span class="nf">directory_arg</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">optname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Argparse type validator for directory arguments.</span>

<span class="sd">    :path: path of directory</span>
<span class="sd">    :optname: name of the option</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> must be a directory, given: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optname</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="n">default_plugins</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;mark&quot;</span><span class="p">,</span>
    <span class="s2">&quot;main&quot;</span><span class="p">,</span>
    <span class="s2">&quot;terminal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;runner&quot;</span><span class="p">,</span>
    <span class="s2">&quot;python&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fixtures&quot;</span><span class="p">,</span>
    <span class="s2">&quot;debugging&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unittest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;capture&quot;</span><span class="p">,</span>
    <span class="s2">&quot;skipping&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tmpdir&quot;</span><span class="p">,</span>
    <span class="s2">&quot;monkeypatch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;recwarn&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pastebin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;helpconfig&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nose&quot;</span><span class="p">,</span>
    <span class="s2">&quot;assertion&quot;</span><span class="p">,</span>
    <span class="s2">&quot;junitxml&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resultlog&quot;</span><span class="p">,</span>
    <span class="s2">&quot;doctest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cacheprovider&quot;</span><span class="p">,</span>
    <span class="s2">&quot;freeze_support&quot;</span><span class="p">,</span>
    <span class="s2">&quot;setuponly&quot;</span><span class="p">,</span>
    <span class="s2">&quot;setupplan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stepwise&quot;</span><span class="p">,</span>
    <span class="s2">&quot;warnings&quot;</span><span class="p">,</span>
    <span class="s2">&quot;logging&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">builtin_plugins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">default_plugins</span><span class="p">)</span>
<span class="n">builtin_plugins</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pytester&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_config</span><span class="p">():</span>
    <span class="c1"># subsequent calls to main will create a fresh instance</span>
    <span class="n">pluginmanager</span> <span class="o">=</span> <span class="n">PytestPluginManager</span><span class="p">()</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">pluginmanager</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">default_plugins</span><span class="p">:</span>
        <span class="n">pluginmanager</span><span class="o">.</span><span class="n">import_plugin</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="k">def</span> <span class="nf">get_plugin_manager</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain a new instance of the</span>
<span class="sd">    :py:class:`_pytest.config.PytestPluginManager`, with default plugins</span>
<span class="sd">    already loaded.</span>

<span class="sd">    This function can be used by integration with other tools, like hooking</span>
<span class="sd">    into pytest to run tests into an IDE.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_config</span><span class="p">()</span><span class="o">.</span><span class="n">pluginmanager</span>


<span class="k">def</span> <span class="nf">_prepareconfig</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plugins</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">warning</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not a string or argument list: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,))</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">posix</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s2">&quot;win32&quot;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">_pytest</span> <span class="kn">import</span> <span class="n">deprecated</span>

        <span class="n">warning</span> <span class="o">=</span> <span class="n">deprecated</span><span class="o">.</span><span class="n">MAIN_STR_ARGS</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="n">pluginmanager</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pluginmanager</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                    <span class="n">pluginmanager</span><span class="o">.</span><span class="n">consider_pluginarg</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pluginmanager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">warning</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">_pytest.warnings</span> <span class="kn">import</span> <span class="n">_issue_config_warning</span>

            <span class="n">_issue_config_warning</span><span class="p">(</span><span class="n">warning</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pluginmanager</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_cmdline_parse</span><span class="p">(</span>
            <span class="n">pluginmanager</span><span class="o">=</span><span class="n">pluginmanager</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">_ensure_unconfigure</span><span class="p">()</span>
        <span class="k">raise</span>


<div class="viewcode-block" id="PytestPluginManager"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager">[docs]</a><span class="k">class</span> <span class="nc">PytestPluginManager</span><span class="p">(</span><span class="n">PluginManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overwrites :py:class:`pluggy.PluginManager &lt;pluggy.PluginManager&gt;` to add pytest-specific</span>
<span class="sd">    functionality:</span>

<span class="sd">    * loading plugins from the command line, ``PYTEST_PLUGINS`` env variable and</span>
<span class="sd">      ``pytest_plugins`` global variables found in plugins being loaded;</span>
<span class="sd">    * ``conftest.py`` loading during start-up;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PytestPluginManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;pytest&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conftest_plugins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># state related to local conftest plugins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dirpath2confmods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conftestpath2mod</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_confcutdir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_noconftest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_duplicatepaths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_hookspecs</span><span class="p">(</span><span class="n">_pytest</span><span class="o">.</span><span class="n">hookspec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PYTEST_DEBUG&quot;</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">dupfile</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">setwriter</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_tracing</span><span class="p">()</span>

        <span class="c1"># Config._consider_importhook will set a real object if required.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rewrite_hook</span> <span class="o">=</span> <span class="n">_pytest</span><span class="o">.</span><span class="n">assertion</span><span class="o">.</span><span class="n">DummyRewriteHook</span><span class="p">()</span>
        <span class="c1"># Used to know when we are importing conftests after the pytest_configure stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="PytestPluginManager.addhooks"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.addhooks">[docs]</a>    <span class="k">def</span> <span class="nf">addhooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_or_class</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 2.8</span>

<span class="sd">        Use :py:meth:`pluggy.PluginManager.add_hookspecs &lt;PluginManager.add_hookspecs&gt;`</span>
<span class="sd">        instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warning</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">code</span><span class="o">=</span><span class="s2">&quot;I2&quot;</span><span class="p">,</span>
            <span class="n">fslocation</span><span class="o">=</span><span class="n">_pytest</span><span class="o">.</span><span class="n">_code</span><span class="o">.</span><span class="n">getfslineno</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">nodeid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;use pluginmanager.add_hookspecs instead of &quot;</span>
            <span class="s2">&quot;deprecated addhooks() method.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_hookspecs</span><span class="p">(</span><span class="n">module_or_class</span><span class="p">)</span></div>

<div class="viewcode-block" id="PytestPluginManager.parse_hookimpl_opts"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.parse_hookimpl_opts">[docs]</a>    <span class="k">def</span> <span class="nf">parse_hookimpl_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># pytest hooks are always prefixed with pytest_</span>
        <span class="c1"># so we avoid accessing possibly non-readable attributes</span>
        <span class="c1"># (see issue #1073)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pytest_&quot;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="c1"># ignore some historic special names which can not be hooks anyway</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pytest_plugins&quot;</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pytest_funcarg__&quot;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PytestPluginManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">parse_hookimpl_opts</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># consider only actual functions for hooks (#3775)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isroutine</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># collect unmarked hooks as long as they have the `pytest_&#39; prefix</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pytest_&quot;</span><span class="p">):</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;tryfirst&quot;</span><span class="p">,</span> <span class="s2">&quot;trylast&quot;</span><span class="p">,</span> <span class="s2">&quot;optionalhook&quot;</span><span class="p">,</span> <span class="s2">&quot;hookwrapper&quot;</span><span class="p">):</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">opts</span></div>

<div class="viewcode-block" id="PytestPluginManager.parse_hookspec_opts"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.parse_hookspec_opts">[docs]</a>    <span class="k">def</span> <span class="nf">parse_hookspec_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_or_class</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PytestPluginManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">parse_hookspec_opts</span><span class="p">(</span>
            <span class="n">module_or_class</span><span class="p">,</span> <span class="n">name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module_or_class</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pytest_&quot;</span><span class="p">):</span>
                <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;firstresult&quot;</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;firstresult&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;historic&quot;</span><span class="p">:</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;historic&quot;</span><span class="p">),</span>
                <span class="p">}</span>
        <span class="k">return</span> <span class="n">opts</span></div>

<div class="viewcode-block" id="PytestPluginManager.register"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;pytest_catchlog&quot;</span><span class="p">,</span> <span class="s2">&quot;pytest_capturelog&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warn</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> plugin has been merged into the core, &quot;</span>
                <span class="s2">&quot;please remove it from your requirements.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PytestPluginManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_plugin_registered</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">consider_module</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="PytestPluginManager.getplugin"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.getplugin">[docs]</a>    <span class="k">def</span> <span class="nf">getplugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># support deprecated naming because plugins (xdist e.g.) use it</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="PytestPluginManager.hasplugin"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.hasplugin">[docs]</a>    <span class="k">def</span> <span class="nf">hasplugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if the plugin with the given name is registered.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PytestPluginManager.pytest_configure"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.pytest_configure">[docs]</a>    <span class="k">def</span> <span class="nf">pytest_configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="c1"># XXX now that the pluginmanager exposes hookimpl(tryfirst...)</span>
        <span class="c1"># we should remove tryfirst/trylast as markers</span>
        <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span>
            <span class="s2">&quot;markers&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tryfirst: mark a hook implementation function such that the &quot;</span>
            <span class="s2">&quot;plugin machinery will try to call it first/as early as possible.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">addinivalue_line</span><span class="p">(</span>
            <span class="s2">&quot;markers&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trylast: mark a hook implementation function such that the &quot;</span>
            <span class="s2">&quot;plugin machinery will try to call it last/as late as possible.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">message</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;I1&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span> <span class="s2">&quot;fslocation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;nodeid&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_logwarning</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># internal API for local conftest plugin handling</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="nf">_set_initial_conftests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load initial conftest files given a preparsed &quot;namespace&quot;.</span>
<span class="sd">            As conftest files may add their own command line options</span>
<span class="sd">            which have arguments (&#39;--my-opt somepath&#39;) we might get some</span>
<span class="sd">            false positives.  All builtin and 3rd party plugins will have</span>
<span class="sd">            been loaded, however, so common options will not confuse our logic</span>
<span class="sd">            here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_confcutdir</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">current</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">namespace</span><span class="o">.</span><span class="n">confcutdir</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">confcutdir</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_noconftest</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">noconftest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_using_pyargs</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">pyargs</span>
        <span class="n">testpaths</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">file_or_dir</span>
        <span class="n">foundanchor</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">testpaths</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># remove node-id syntax</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">anchor</span><span class="p">):</span>  <span class="c1"># we found some file object</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_try_load_conftest</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span>
                <span class="n">foundanchor</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">foundanchor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_try_load_conftest</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_try_load_conftest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getconftestmodules</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span>
        <span class="c1"># let&#39;s also consider test* subdirs</span>
        <span class="k">if</span> <span class="n">anchor</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">anchor</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;test*&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_getconftestmodules</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_getconftestmodules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_noconftest</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">():</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirpath</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>  <span class="c1"># py2 is not using lru_cache.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirpath2confmods</span><span class="p">[</span><span class="n">directory</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># XXX these days we may rather want to use config.rootdir</span>
        <span class="c1"># and allow users to opt into looking into the rootdir parent</span>
        <span class="c1"># directories instead of requiring to specify confcutdir</span>
        <span class="n">clist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">directory</span><span class="o">.</span><span class="n">realpath</span><span class="p">()</span><span class="o">.</span><span class="n">parts</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confcutdir</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confcutdir</span><span class="o">.</span><span class="n">relto</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">conftestpath</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;conftest.py&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">conftestpath</span><span class="o">.</span><span class="n">isfile</span><span class="p">():</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_importconftest</span><span class="p">(</span><span class="n">conftestpath</span><span class="p">)</span>
                <span class="n">clist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dirpath2confmods</span><span class="p">[</span><span class="n">directory</span><span class="p">]</span> <span class="o">=</span> <span class="n">clist</span>
        <span class="k">return</span> <span class="n">clist</span>

    <span class="k">def</span> <span class="nf">_rget_with_confmod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getconftestmodules</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">modules</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mod</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_importconftest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conftestpath</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_conftestpath2mod</span><span class="p">[</span><span class="n">conftestpath</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">pkgpath</span> <span class="o">=</span> <span class="n">conftestpath</span><span class="o">.</span><span class="n">pypkgpath</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pkgpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_ensure_removed_sysmodule</span><span class="p">(</span><span class="n">conftestpath</span><span class="o">.</span><span class="n">purebasename</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">conftestpath</span><span class="o">.</span><span class="n">pyimport</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">hasattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="s2">&quot;pytest_plugins&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_using_pyargs</span>
                <span class="p">):</span>
                    <span class="kn">from</span> <span class="nn">_pytest.deprecated</span> <span class="kn">import</span> <span class="p">(</span>
                        <span class="n">PYTEST_PLUGINS_FROM_NON_TOP_LEVEL_CONFTEST</span>
                    <span class="p">)</span>

                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span>
                        <span class="n">PYTEST_PLUGINS_FROM_NON_TOP_LEVEL_CONFTEST</span><span class="p">,</span>
                        <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">conftestpath</span><span class="p">),</span>
                        <span class="n">lineno</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConftestImportFailure</span><span class="p">(</span><span class="n">conftestpath</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_conftest_plugins</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_conftestpath2mod</span><span class="p">[</span><span class="n">conftestpath</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>
            <span class="n">dirpath</span> <span class="o">=</span> <span class="n">conftestpath</span><span class="o">.</span><span class="n">dirpath</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dirpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirpath2confmods</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">mods</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirpath2confmods</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">relto</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span> <span class="o">==</span> <span class="n">dirpath</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">mod</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mods</span>
                        <span class="n">mods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;loaded conftestmodule </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mod</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consider_conftest</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">mod</span>

    <span class="c1">#</span>
    <span class="c1"># API for bootstrapping plugin loading</span>
    <span class="c1">#</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="PytestPluginManager.consider_preparse"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.consider_preparse">[docs]</a>    <span class="k">def</span> <span class="nf">consider_preparse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">opt2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">opt1</span> <span class="o">==</span> <span class="s2">&quot;-p&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">consider_pluginarg</span><span class="p">(</span><span class="n">opt2</span><span class="p">)</span></div>

<div class="viewcode-block" id="PytestPluginManager.consider_pluginarg"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.consider_pluginarg">[docs]</a>    <span class="k">def</span> <span class="nf">consider_pluginarg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;no:&quot;</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="c1"># PR #4304 : remove stepwise if cacheprovider is blocked</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cacheprovider&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_blocked</span><span class="p">(</span><span class="s2">&quot;stepwise&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_blocked</span><span class="p">(</span><span class="s2">&quot;pytest_stepwise&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_blocked</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pytest_&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_blocked</span><span class="p">(</span><span class="s2">&quot;pytest_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_plugin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span></div>

<div class="viewcode-block" id="PytestPluginManager.consider_conftest"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.consider_conftest">[docs]</a>    <span class="k">def</span> <span class="nf">consider_conftest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conftestmodule</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">conftestmodule</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">conftestmodule</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span></div>

<div class="viewcode-block" id="PytestPluginManager.consider_env"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.consider_env">[docs]</a>    <span class="k">def</span> <span class="nf">consider_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_plugin_specs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PYTEST_PLUGINS&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="PytestPluginManager.consider_module"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.consider_module">[docs]</a>    <span class="k">def</span> <span class="nf">consider_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_plugin_specs</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="s2">&quot;pytest_plugins&quot;</span><span class="p">,</span> <span class="p">[]))</span></div>

    <span class="k">def</span> <span class="nf">_import_plugin_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="n">_get_plugin_specs_as_list</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">import_spec</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_plugin</span><span class="p">(</span><span class="n">import_spec</span><span class="p">)</span>

<div class="viewcode-block" id="PytestPluginManager.import_plugin"><a class="viewcode-back" href="../../reference.html#_pytest.config.PytestPluginManager.import_plugin">[docs]</a>    <span class="k">def</span> <span class="nf">import_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">):</span>
        <span class="c1"># most often modname refers to builtin modules, e.g. &quot;pytester&quot;,</span>
        <span class="c1"># &quot;terminal&quot; or &quot;capture&quot;.  Those plugins are registered under their</span>
        <span class="c1"># basename for historic purposes but must be imported with the</span>
        <span class="c1"># _pytest prefix.</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span> <span class="p">(</span>
            <span class="s2">&quot;module name as text required, got </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">modname</span>
        <span class="p">)</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_blocked</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">modname</span> <span class="ow">in</span> <span class="n">builtin_plugins</span><span class="p">:</span>
            <span class="n">importspec</span> <span class="o">=</span> <span class="s2">&quot;_pytest.&quot;</span> <span class="o">+</span> <span class="n">modname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">importspec</span> <span class="o">=</span> <span class="n">modname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rewrite_hook</span><span class="o">.</span><span class="n">mark_rewrite</span><span class="p">(</span><span class="n">importspec</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">__import__</span><span class="p">(</span><span class="n">importspec</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">new_exc_type</span> <span class="o">=</span> <span class="ne">ImportError</span>
            <span class="n">new_exc_message</span> <span class="o">=</span> <span class="s1">&#39;Error importing plugin &quot;</span><span class="si">%s</span><span class="s1">&quot;: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">modname</span><span class="p">,</span>
                <span class="n">safe_str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="n">new_exc</span> <span class="o">=</span> <span class="n">new_exc_type</span><span class="p">(</span><span class="n">new_exc_message</span><span class="p">)</span>

            <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">new_exc_type</span><span class="p">,</span> <span class="n">new_exc</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">except</span> <span class="n">Skipped</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warn</span><span class="p">(</span><span class="s2">&quot;skipped plugin </span><span class="si">%r</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">modname</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">msg</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">importspec</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">_get_plugin_specs_as_list</span><span class="p">(</span><span class="n">specs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses a list of &quot;plugin specs&quot; and returns a list of plugin names.</span>

<span class="sd">    Plugin specs can be given as a list of strings separated by &quot;,&quot; or already as a list/tuple in</span>
<span class="sd">    which case it is returned as a list. Specs can also be `None` in which case an</span>
<span class="sd">    empty list is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">specs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">specs</span> <span class="o">=</span> <span class="n">specs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">specs</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span>
                <span class="s2">&quot;Plugin specs must be a &#39;,&#39;-separated string or a &quot;</span>
                <span class="s2">&quot;list/tuple of strings for plugin names. Given: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">specs</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">specs</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">_ensure_removed_sysmodule</span><span class="p">(</span><span class="n">modname</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Notset</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;NOTSET&gt;&quot;</span>


<span class="n">notset</span> <span class="o">=</span> <span class="n">Notset</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_iter_rewritable_modules</span><span class="p">(</span><span class="n">package_files</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">package_files</span><span class="p">:</span>
        <span class="n">is_simple_module</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fn</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span>
        <span class="n">is_package</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_simple_module</span><span class="p">:</span>
            <span class="n">module_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">module_name</span>
        <span class="k">elif</span> <span class="n">is_package</span><span class="p">:</span>
            <span class="n">package_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">package_name</span>


<div class="viewcode-block" id="Config"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config">[docs]</a><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; access to configuration values, pluginmanager and plugin hooks.  &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pluginmanager</span><span class="p">):</span>
        <span class="c1">#: access to command line option as attributes.</span>
        <span class="c1">#: (deprecated), use :py:func:`getoption() &lt;_pytest.config.Config.getoption&gt;` instead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">.argparsing</span> <span class="kn">import</span> <span class="n">Parser</span><span class="p">,</span> <span class="n">FILE_OR_DIR</span>

        <span class="n">_a</span> <span class="o">=</span> <span class="n">FILE_OR_DIR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">(</span>
            <span class="n">usage</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">(prog)s [options] [</span><span class="si">%s</span><span class="s2">] [</span><span class="si">%s</span><span class="s2">] [...]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_a</span><span class="p">),</span>
            <span class="n">processopt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_processopt</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1">#: a pluginmanager instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span> <span class="o">=</span> <span class="n">pluginmanager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">hook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inicache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_override_ini</span> <span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_opt2dest</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">_warn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;pytestconfig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="nf">do_setns</span><span class="p">(</span><span class="n">dic</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">pytest</span>

            <span class="n">setns</span><span class="p">(</span><span class="n">pytest</span><span class="p">,</span> <span class="n">dic</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_namespace</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span><span class="n">do_setns</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_addoption</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">parser</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="p">))</span>

<div class="viewcode-block" id="Config.add_cleanup"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.add_cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">add_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a function to be called when the config object gets out of</span>
<span class="sd">        use (usually coninciding with pytest_unconfigure).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_do_configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_configure</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ensure_unconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configured</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_unconfigure</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_configure</span><span class="o">.</span><span class="n">_call_history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">:</span>
            <span class="n">fin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">fin</span><span class="p">()</span>

<div class="viewcode-block" id="Config.warn"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.warn">[docs]</a>    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">fslocation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodeid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 3.8</span>

<span class="sd">            Use :py:func:`warnings.warn` or :py:func:`warnings.warn_explicit` directly instead.</span>

<span class="sd">        Generate a warning for this test session.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">_pytest.warning_types</span> <span class="kn">import</span> <span class="n">RemovedInPytest4Warning</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fslocation</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fslocation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">fslocation</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;unknown file&quot;</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;config.warn has been deprecated, use warnings.warn instead&quot;</span>
        <span class="k">if</span> <span class="n">nodeid</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodeid</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span>
            <span class="n">RemovedInPytest4Warning</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span>
            <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">lineno</span><span class="o">=</span><span class="n">lineno</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_logwarning</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">fslocation</span><span class="o">=</span><span class="n">fslocation</span><span class="p">,</span> <span class="n">nodeid</span><span class="o">=</span><span class="n">nodeid</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_terminal_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="s2">&quot;terminalreporter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">_tw</span>

    <span class="k">def</span> <span class="nf">pytest_cmdline_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pluginmanager</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c1"># REF1 assert self == pluginmanager.config, (self, pluginmanager.config)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">notify_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">excinfo</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">and</span> <span class="n">option</span><span class="o">.</span><span class="n">fulltrace</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;long&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;native&quot;</span>
        <span class="n">excrepr</span> <span class="o">=</span> <span class="n">excinfo</span><span class="o">.</span><span class="n">getrepr</span><span class="p">(</span>
            <span class="n">funcargs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showlocals</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="s2">&quot;showlocals&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span>
        <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_internalerror</span><span class="p">(</span><span class="n">excrepr</span><span class="o">=</span><span class="n">excrepr</span><span class="p">,</span> <span class="n">excinfo</span><span class="o">=</span><span class="n">excinfo</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">excrepr</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INTERNALERROR&gt; </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">cwd_relative_nodeid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">):</span>
        <span class="c1"># nodeid&#39;s are relative to the rootpath, compute relative to cwd</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invocation_dir</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">:</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nodeid</span><span class="p">)</span>
            <span class="n">nodeid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invocation_dir</span><span class="o">.</span><span class="n">bestrelpath</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodeid</span>

<div class="viewcode-block" id="Config.fromdictargs"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.fromdictargs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromdictargs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">option_dict</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor useable for subprocesses. &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">option_dict</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">addopts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">consider_pluginarg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config</span></div>

    <span class="k">def</span> <span class="nf">_processopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">opt</span><span class="o">.</span><span class="n">_short_opts</span> <span class="o">+</span> <span class="n">opt</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_opt2dest</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">dest</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">opt</span><span class="o">.</span><span class="n">dest</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">dest</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

    <span class="nd">@hookimpl</span><span class="p">(</span><span class="n">trylast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pytest_load_initial_conftests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">early_config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">_set_initial_conftests</span><span class="p">(</span><span class="n">early_config</span><span class="o">.</span><span class="n">known_args_namespace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">ns</span><span class="p">,</span> <span class="n">unknown_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse_known_and_unknown_args</span><span class="p">(</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">determine_setup</span><span class="p">(</span>
            <span class="n">ns</span><span class="o">.</span><span class="n">inifilename</span><span class="p">,</span>
            <span class="n">ns</span><span class="o">.</span><span class="n">file_or_dir</span> <span class="o">+</span> <span class="n">unknown_args</span><span class="p">,</span>
            <span class="n">rootdir_cmd_arg</span><span class="o">=</span><span class="n">ns</span><span class="o">.</span><span class="n">rootdir</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inifile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inicfg</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">extra_info</span><span class="p">[</span><span class="s2">&quot;rootdir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">extra_info</span><span class="p">[</span><span class="s2">&quot;inifile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inifile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invocation_dir</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">addini</span><span class="p">(</span><span class="s2">&quot;addopts&quot;</span><span class="p">,</span> <span class="s2">&quot;extra command line options&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">addini</span><span class="p">(</span><span class="s2">&quot;minversion&quot;</span><span class="p">,</span> <span class="s2">&quot;minimally required pytest version&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_override_ini</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">override_ini</span> <span class="ow">or</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">_consider_importhook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Install the PEP 302 import hook if using assertion rewriting.</span>

<span class="sd">        Needs to parse the --assert=&lt;mode&gt; option from the commandline</span>
<span class="sd">        and find all the installed plugins to mark them for rewriting</span>
<span class="sd">        by the importhook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ns</span><span class="p">,</span> <span class="n">unknown_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse_known_and_unknown_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">assertmode</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;rewrite&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hook</span> <span class="o">=</span> <span class="n">_pytest</span><span class="o">.</span><span class="n">assertion</span><span class="o">.</span><span class="n">install_importhook</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">SystemError</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;plain&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mark_plugins_for_rewrite</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
        <span class="n">_warn_about_missing_assertion</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mark_plugins_for_rewrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an importhook, mark for rewrite any top-level</span>
<span class="sd">        modules or packages in the distribution package for</span>
<span class="sd">        all pytest plugins.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">pkg_resources</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">rewrite_hook</span> <span class="o">=</span> <span class="n">hook</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PYTEST_DISABLE_PLUGIN_AUTOLOAD&quot;</span><span class="p">):</span>
            <span class="c1"># We don&#39;t autoload from setuptools entry points, no need to continue.</span>
            <span class="k">return</span>

        <span class="c1"># &#39;RECORD&#39; available for plugins installed normally (pip install)</span>
        <span class="c1"># &#39;SOURCES.txt&#39; available for plugins installed in dev mode (pip install -e)</span>
        <span class="c1"># for installed plugins &#39;SOURCES.txt&#39; returns an empty list, and vice-versa</span>
        <span class="c1"># so it shouldn&#39;t be an issue</span>
        <span class="n">metadata_files</span> <span class="o">=</span> <span class="s2">&quot;RECORD&quot;</span><span class="p">,</span> <span class="s2">&quot;SOURCES.txt&quot;</span>

        <span class="n">package_files</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">entrypoint</span> <span class="ow">in</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">iter_entry_points</span><span class="p">(</span><span class="s2">&quot;pytest11&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">metadata_files</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">_get_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_iter_rewritable_modules</span><span class="p">(</span><span class="n">package_files</span><span class="p">):</span>
            <span class="n">hook</span><span class="o">.</span><span class="n">mark_rewrite</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_preparse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">addopts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">addopts</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PYTEST_ADDOPTS&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initini</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">addopts</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getini</span><span class="p">(</span><span class="s2">&quot;addopts&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkversion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_consider_importhook</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">consider_preparse</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PYTEST_DISABLE_PLUGIN_AUTOLOAD&quot;</span><span class="p">):</span>
            <span class="c1"># Don&#39;t autoload from setuptools entry point. Only explicitly specified</span>
            <span class="c1"># plugins are going to be loaded.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">load_setuptools_entrypoints</span><span class="p">(</span><span class="s2">&quot;pytest11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">consider_env</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">known_args_namespace</span> <span class="o">=</span> <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_args_namespace</span><span class="o">.</span><span class="n">confcutdir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">inifile</span><span class="p">:</span>
            <span class="n">confcutdir</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inifile</span><span class="p">)</span><span class="o">.</span><span class="n">dirname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">known_args_namespace</span><span class="o">.</span><span class="n">confcutdir</span> <span class="o">=</span> <span class="n">confcutdir</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_load_initial_conftests</span><span class="p">(</span>
                <span class="n">early_config</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parser</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">ConftestImportFailure</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ns</span><span class="o">.</span><span class="n">help</span> <span class="ow">or</span> <span class="n">ns</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
                <span class="c1"># we don&#39;t want to prevent --help/--version to work</span>
                <span class="c1"># so just let is pass and print a warning at the end</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_warn</span><span class="p">(</span><span class="s2">&quot;could not load initial conftests (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_checkversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">pytest</span>

        <span class="n">minver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inicfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;minversion&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">minver</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="n">minver</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">LooseVersion</span><span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">__version__</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">pytest</span><span class="o">.</span><span class="n">UsageError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">: requires pytest-</span><span class="si">%s</span><span class="s2">, actual pytest-</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                    <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">inicfg</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">inicfg</span><span class="o">.</span><span class="n">lineof</span><span class="p">(</span><span class="s2">&quot;minversion&quot;</span><span class="p">),</span>
                        <span class="n">minver</span><span class="p">,</span>
                        <span class="n">pytest</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">addopts</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># parse given cmdline arguments into this config object.</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;can only parse cmdline args at most once per Config object&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origargs</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_addhooks</span><span class="o">.</span><span class="n">call_historic</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">pluginmanager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preparse</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">addopts</span><span class="o">=</span><span class="n">addopts</span><span class="p">)</span>
        <span class="c1"># XXX deprecated hook:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">pytest_cmdline_preparse</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">after_preparse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse_setoption</span><span class="p">(</span>
                <span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">option</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">option</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cwd</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getini</span><span class="p">(</span><span class="s2">&quot;testpaths&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">cwd</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">except</span> <span class="n">PrintHelp</span><span class="p">:</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="Config.addinivalue_line"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.addinivalue_line">[docs]</a>    <span class="k">def</span> <span class="nf">addinivalue_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a line to an ini-file option. The option must have been</span>
<span class="sd">        declared but might not yet be set in which case the line becomes the</span>
<span class="sd">        the first line in its value. &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getini</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>  <span class="c1"># modifies the cached list inline</span></div>

<div class="viewcode-block" id="Config.getini"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.getini">[docs]</a>    <span class="k">def</span> <span class="nf">getini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return configuration value from an :ref:`ini file &lt;inifiles&gt;`. If the</span>
<span class="sd">        specified name hasn&#39;t been registered through a prior</span>
<span class="sd">        :py:func:`parser.addini &lt;_pytest.config.Parser.addini&gt;`</span>
<span class="sd">        call (usually from a plugin), a ValueError is raised. &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inicache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inicache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getini</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span></div>

    <span class="k">def</span> <span class="nf">_getini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">description</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">_inidict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown configuration value: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_override_ini_value</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inicfg</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">default</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;pathlist&quot;</span><span class="p">:</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inicfg</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">dirpath</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">relpath</span> <span class="ow">in</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relpath</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">values</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;linelist&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">t</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_strtobool</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_getconftest_pathlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mod</span><span class="p">,</span> <span class="n">relroots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">_rget_with_confmod</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">modpath</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">dirpath</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">relroot</span> <span class="ow">in</span> <span class="n">relroots</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">relroot</span><span class="p">,</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="p">):</span>
                <span class="n">relroot</span> <span class="o">=</span> <span class="n">relroot</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">py</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
                <span class="n">relroot</span> <span class="o">=</span> <span class="n">modpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relroot</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">relroot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">_get_override_ini_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># override_ini is a list of &quot;ini=value&quot; options</span>
        <span class="c1"># always use the last item if multiple values are set for same ini-name,</span>
        <span class="c1"># e.g. -o foo=bar1 -o foo=bar2 will set foo to bar2</span>
        <span class="k">for</span> <span class="n">ini_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_override_ini</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">user_ini_value</span> <span class="o">=</span> <span class="n">ini_config</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s2">&quot;-o/--override-ini expects option=value style.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">user_ini_value</span>
        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="Config.getoption"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.getoption">[docs]</a>    <span class="k">def</span> <span class="nf">getoption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">notset</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return command line option value.</span>

<span class="sd">        :arg name: name of the option.  You may also specify</span>
<span class="sd">            the literal ``--OPT`` option instead of the &quot;dest&quot; option name.</span>
<span class="sd">        :arg default: default value if no option of that name exists.</span>
<span class="sd">        :arg skip: if True raise pytest.skip if option does not exists</span>
<span class="sd">            or has a None value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opt2dest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">skip</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">notset</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">default</span>
            <span class="k">if</span> <span class="n">skip</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">pytest</span>

                <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;no </span><span class="si">%r</span><span class="s2"> option found&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;no option named </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span></div>

<div class="viewcode-block" id="Config.getvalue"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.getvalue">[docs]</a>    <span class="k">def</span> <span class="nf">getvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; (deprecated, use getoption()) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Config.getvalueorskip"><a class="viewcode-back" href="../../reference.html#_pytest.config.Config.getvalueorskip">[docs]</a>    <span class="k">def</span> <span class="nf">getvalueorskip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; (deprecated, use getoption(skip=True)) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">_assertion_supported</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_warn_about_missing_assertion</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_assertion_supported</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;plain&quot;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: ASSERTIONS ARE NOT EXECUTED&quot;</span>
                <span class="s2">&quot; and FAILING TESTS WILL PASS.  Are you&quot;</span>
                <span class="s2">&quot; using python -O?&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: assertions not in test modules or&quot;</span>
                <span class="s2">&quot; plugins will be ignored&quot;</span>
                <span class="s2">&quot; because assert statements are not executed &quot;</span>
                <span class="s2">&quot;by the underlying Python interpreter &quot;</span>
                <span class="s2">&quot;(are you using python -O?)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>


<span class="k">def</span> <span class="nf">setns</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pytest</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">modname</span> <span class="o">=</span> <span class="s2">&quot;pytest.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>
                <span class="n">mod</span><span class="o">.</span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mod</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">setns</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">__all__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># if obj != pytest:</span>
            <span class="c1">#    pytest.__all__.append(name)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">pytest</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">create_terminal_writer</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a TerminalWriter instance configured according to the options</span>
<span class="sd">    in the config object. Every code which requires a TerminalWriter object</span>
<span class="sd">    and has access to a config object should use this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tw</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">TerminalWriter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
        <span class="n">tw</span><span class="o">.</span><span class="n">hasmarkup</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
        <span class="n">tw</span><span class="o">.</span><span class="n">hasmarkup</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">tw</span>


<span class="k">def</span> <span class="nf">_strtobool</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a string representation of truth to true (1) or false (0).</span>

<span class="sd">    True values are &#39;y&#39;, &#39;yes&#39;, &#39;t&#39;, &#39;true&#39;, &#39;on&#39;, and &#39;1&#39;; false values</span>
<span class="sd">    are &#39;n&#39;, &#39;no&#39;, &#39;f&#39;, &#39;false&#39;, &#39;off&#39;, and &#39;0&#39;.  Raises ValueError if</span>
<span class="sd">    &#39;val&#39; is anything else.</span>

<span class="sd">    .. note:: copied from distutils.util</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid truth value </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,))</span>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../contents.html">pytest-3.10</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 20152018 , holger krekel and pytest-dev team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7597274-13']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>